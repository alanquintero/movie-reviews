<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Movie Management</title>
    <link rel="stylesheet" th:href="@{/resources/css/bootstrap.min.css}"/>
    <script th:src="@{/resources/js/jquery.min.js}"></script>
    <script th:src="@{/resources/js/bootstrap.min.js}"></script>
    <script th:src="@{/resources/js/jquery.validate.min.js}"></script>
</head>
<body>

<div>

    <div userRole="tabpanel" class="tab-pane" id="reviews">
        <br><br>
        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal"
                data-target="#movieModal" onclick="resetModal();">
            Add Movie
        </button>

        <div th:if="${success == true}" id="message" class="alert alert-success">
            Successful!
        </div>
        <div th:if="${success == false}" id="message" class="alert alert-danger">
            Sorry! Movie already exists.
        </div>
    </div>

    <div>
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>Movie</th>
                <th>Rating</th>
                <th></th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="movie : ${movies}">
                <td>
                    <a th:href="@{/movie/{code}.html(code=${movie.code})}">
                        <span th:text="${movie.title}"></span>
                        <font color="gray">(<span th:text="${movie.year}"></span>)</font>
                    </a>
                </td>
                <td th:text="${movie.rating}"></td>
                <td>
                    <button type="button" class="btn btn-primary"
                            th:onclick="'fillForm(\'' + ${movie.code} + '\',\''
                                + ${movie.title} + '\',\'' + ${movie.year} + '\',\''
                                + ${movie.image} + '\',\'' + ${movie.trailerUrl} + '\',\''
                                + ${movie.synopsis} + '\')'">
                        Update Movie
                    </button>
                </td>
                <td>
                    <a th:href="@{/movies/remove/{code}.html(code=${movie.code})}"
                       class="btn btn-danger triggerRemove">
                        Remove Movie
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div>
        <form th:object="${movie}" class="form-horizontal movieForm">

            <!-- Modal -->
            <div class="modal fade" id="movieModal" tabindex="-1" userRole="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" userRole="document">
                    <div class="modal-content">

                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title" id="myModalLabel">Movie</h4>
                        </div>

                        <div class="modal-body">

                            <div class="form-group">
                                <label for="title" class="col-sm-2 control-label">Title:</label>
                                <div class="col-sm-10">
                                    <input type="hidden" th:field="*{code}" id="movie.code"/>
                                    <input type="text" th:field="*{title}" id="movie.title" class="form-control"
                                           placeholder="Title" maxlength="50" autocomplete="off"/>
                                    <div th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="year" class="col-sm-2 control-label">Year:</label>
                                <div class="col-sm-10">
                                    <input type="number" th:field="*{year}" id="movie.year" class="form-control"
                                           placeholder="Year" maxlength="4" autocomplete="off"/>
                                    <div th:if="${#fields.hasErrors('year')}" th:errors="*{year}"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="image" class="col-sm-2 control-label">Image URL:</label>
                                <div class="col-sm-10">
                                    <input type="text" th:field="*{image}" id="movie.image" class="form-control"
                                           placeholder="Image URL" maxlength="200" autocomplete="off"/>
                                    <div th:if="${#fields.hasErrors('image')}" th:errors="*{image}"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="trailer" class="col-sm-2 control-label">Trailer URL:</label>
                                <div class="col-sm-10">
                                    <input type="text" th:field="*{trailerUrl}" id="movie.trailer" class="form-control"
                                           placeholder="Trailer URL" maxlength="200" autocomplete="off"/>
                                    <div th:if="${#fields.hasErrors('trailer')}" th:errors="*{trailerUrl}"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="synopsis" class="col-sm-2 control-label">Synopsis:</label>
                                <div class="col-sm-10">
                                    <textarea th:field="*{synopsis}" id="movie.synopsis" class="form-control"
                                              placeholder="Synopsis" rows="3" maxlength="350"
                                              autocomplete="off"></textarea>
                                    <div th:if="${#fields.hasErrors('synopsis')}" th:errors="*{synopsis}"></div>
                                </div>
                            </div>

                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <input id="submitBtn" type="submit" class="btn btn-primary" value="Add Movie"/>
                        </div>

                    </div>
                </div>
            </div>

        </form>
    </div>

</div>

<script type="text/javascript">
    $(document).ready(function () {
        $(".movieForm").validate({
            rules: {
                title: {required: true, minlength: 3},
                year: {required: true, minlength: 4, maxlength: 4},
                image: {required: true, minlength: 5},
                trailer: {required: true, minlength: 5},
                synopsis: {required: true, minlength: 5}
            },
            highlight: function (element) {
                $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
            },
            unhighlight: function (element) {
                $(element).closest('.form-group').removeClass('has-error').addClass('has-success');
            }
        });
        $("#message").delay(3000).fadeOut("slow");
    });

    $(".triggerRemove").click(function (e) {
        e.preventDefault();
        $("#modalRemove .removeBtn").attr("href", $(this).attr("href"));
        $("#removeModalLabel").text("Remove Movie");
        $("#confirmationMessage").text("Are you sure to delete this Movie?");
        $("#modalRemove").modal();
    });

    function fillForm(code, movieTitle, movieYear, movieImage, movieTrailer, movieSynopsis) {
        document.getElementById("movie.code").value = code;
        document.getElementById("movie.title").value = movieTitle;
        document.getElementById("movie.year").value = movieYear;
        document.getElementById("movie.image").value = movieImage;
        document.getElementById("movie.trailer").value = movieTrailer;
        document.getElementById("movie.synopsis").value = movieSynopsis;
        document.getElementById("submitBtn").value = "Update Movie";
        $("#movieModal").modal();
    }

    function resetModal() {
        document.getElementById("movie.code").value = "";
        document.getElementById("movie.title").value = "";
        document.getElementById("movie.year").value = "";
        document.getElementById("movie.image").value = "";
        document.getElementById("movie.trailer").value = "";
        document.getElementById("movie.synopsis").value = "";
        document.getElementById("submitBtn").value = "Save Movie";
    }
</script>

</body>
</html>
