<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>User Registration</title>
    <link rel="stylesheet" th:href="@{/resources/css/bootstrap.min.css}"/>
    <script th:src="@{/resources/js/jquery.min.js}"></script>
    <script th:src="@{/resources/js/jquery.validate.min.js}"></script>
</head>
<body>

<div>

    <form th:object="${appUser}" class="form-horizontal registrationForm" method="post">

        <div th:if="${success == true}" class="alert alert-success">
            Registration Successful! Please Log in!
        </div>
        <div th:if="${success == false}" class="alert alert-danger">
            Sorry! Something went wrong. Please try again later.
        </div>

        <h3 class="text-center">
            Register
            <span class="label label-default">Free</span>
        </h3>

        <div class="form-group">
            <label for="userName" class="col-sm-2 control-label">User Name:</label>
            <div class="col-sm-10">
                <input type="text" th:field="*{userName}" id="userName" class="form-control"
                       placeholder="userName" maxlength="30" autocomplete="off"/>
                <div th:if="${#fields.hasErrors('userName')}" th:errors="*{userName}"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="email" class="col-sm-2 control-label">Email:</label>
            <div class="col-sm-10">
                <input type="email" th:field="*{email}" id="email" class="form-control"
                       placeholder="someone@example.com" maxlength="30" autocomplete="off"/>
                <div th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="password" class="col-sm-2 control-label">Password:</label>
            <div class="col-sm-10">
                <input type="password" th:field="*{password}" id="password" class="form-control" maxlength="30"/>
                <div th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="password_again" class="col-sm-2 control-label">Password again:</label>
            <div class="col-sm-10">
                <input type="password" id="password_again" userName="password_again" class="form-control"
                       maxlength="30"/>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-4 col-md-offset-4">
                <button type="submit" class="btn btn-primary btn-block">Save</button>
            </div>
        </div>

    </form>

</div>

<script type="text/javascript">
    $(document).ready(function () {
        $(".registrationForm").validate({
            rules: {
                userName: {
                    required: true,
                    minlength: 4,
                    remote: {
                        url: /*[[@{/register/checkusername.html}]]*/,
                        type: "get",
                        data: {
                            userName: function () {
                                return $("#userName").val();
                            }
                        }
                    }
                },
                email: {
                    required: true,
                    email: true,
                    remote: {
                        url: /*[[@{/register/checkuseremail.html}]]*/,
                        type: "get",
                        data: {
                            userEmail: function () {
                                return $("#email").val();
                            }
                        }
                    }
                },
                password: {
                    required: true,
                    minlength: 6
                },
                password_again: {
                    required: true,
                    minlength: 6,
                    equalTo: "#password"
                }
            },
            highlight: function (element) {
                $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
            },
            unhighlight: function (element) {
                $(element).closest('.form-group').removeClass('has-error').addClass('has-success');
            },
            messages: {
                userName: {remote: "Username already exists!"},
                email: {remote: "Email is already in use!"}
            }
        });
    });
</script>

</body>
</html>
